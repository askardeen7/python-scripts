import os
import subprocess

def delete_unused_docker_images():
    print("ğŸ” Checking for unused (dangling) Docker images...\n")

    try:
        # Get list of dangling images (untagged or unused)
        result = subprocess.run(
            ["docker", "images", "-f", "dangling=true", "-q"],
            stdout=subprocess.PIPE,
            stderr=subprocess.PIPE,
            text=True,
            check=True
        )

        image_ids = result.stdout.strip().splitlines()

        if not image_ids:
            print("âœ… No unused Docker images found.")
            return

        for image_id in image_ids:
            print(f"ğŸ—‘ï¸ Removing unused Docker image: {image_id}")
            subprocess.run(["docker", "rmi", "-f", image_id], check=False)

        print("\nâœ… Cleanup complete â€” all unused Docker images removed.")

    except subprocess.CalledProcessError as e:
        print(f"âŒ Error checking images: {e.stderr}")

def main():
    print("==== Docker Unused Image Cleanup Started ====")
    delete_unused_docker_images()
    print("==== Cleanup Completed ====")

if __name__ == "__main__":
    main()
